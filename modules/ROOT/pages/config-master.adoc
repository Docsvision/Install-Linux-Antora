= Мастер настройки БД {dv}

Пользователь, выполняющий настройку {dv}, должен являться локальным администратором (быть указанным в файле sudoers).
// Если группа безопасности *{dv-admins-serv}* не существует, она будет создана автоматически при первой настройке системы {dv}.

Если для подключения к СУБД планируется использовать Windows-аутентификацию, у учетной записи, от имени которой запущена _{cns}_, должны быть следующие права:

include::install-linux::partial$dbRights.adoc[]

Запустите _{cns}_ на машине Windows, с установленными серверными компонентами системы.

[#db-settings]
== Настройка системной БД

.Выполните следующие шаги, чтобы подготовить систему {dv} к работе:
// tag::master[]
. Откройте программу _{cns}_ (ярлык "{dv} Server Console") и откажитесь от продолжения настройки.
// . На странице _Лицензия_ активируйте ключ лицензии {dv}: menu:Активировать ключ[Онлайн активация > Далее > Укажите серийный ключ > Завершить].
// +
// .Мастер настройки {dv}
// image::install-linux::config-license.png[Мастер настройки {dv}]
// +
// [NOTE]
// ====
// Подробнее про активацию можно прочитать в разделе "xref:install-linux::activation.adoc[]".
//
// В случае отсутствия интернет-подключения воспользуйтесь офлайн-активацией.
// ====
// . На странице _Требования к системе_ ознакомьтесь с результатами проверки требований {dv} к системе.
// +
// .Проверка основных требований к системе
// image::install-linux::config-requirements.png[Проверка основных требований к системе]
// +
// ****
// * Если не пройдена проверка `Наличие группы или учетной записи IIS "IIS_IUSRS"` или `Наличие модулей NTLM и Basic аутентификации`, выполните действия, перечисленные в пункте xref:pre-config-section-server.adoc[Настройка операционной системы].
// * Если не пройдена проверка `Принадлежность пользователя %username% к группе {dv-admins-serv}`:
// [lowerroman]
// .. Закройте _Мастер настройки {dv}_.
. Убедитесь, что пользователь, от имени которого выполняется настройка БД, добавлен в группу безопасности *{dv-admins-serv}*.
+
Если требуется, добавьте пользователя в группу *{dv-admins-serv}* самостоятельно. Группы безопасности настраиваются в конфигурационном файле модуля {pl}, см. подробнее в разделе "xref:config-platform.adoc[]".
+
// .. Повторно авторизуйтесь в Windows (выполните Logoff/Logon).
. Выполните настройку БД с помощью мастера баз данных (раздел "Базы данных"):
// ****
// +
// . На странице _Веб-сервер_ выберите сайт IIS для публикации сервера {dv}.
// +
// ****
// На выбранном сайте будет опубликовано приложение {dv}. Для приложения будет создан собственный пул _DefaultAppPool_.
// ****
// end::master[]
// +
// tag::dbase[]
+
.Раздел "Базы данных" Консоли настройки {dv}
image::platform:admin:settings-database.png[Раздел "Базы данных" Консоли настройки {dv}]
+
* Подключите существующую базу данных {dv}. Инструкция по подключению существующей БД приведена в документации модуля {pl}, раздел "xref:platform:console:db-connect.adoc[]".
+
* Создайте новую базу данных. Инструкция по созданию новой БД приведена в документации модуля {pl}, раздел "xref:platform:console:db-create.adoc[]".
+
Ниже приводится обобщённая инструкция по созданию БД, подробная инструкция приведена в документации модуля {pl}, раздел "xref:platform:console:db-create.adoc[]".
+
[NOTE]
====
Перед созданием новой БД ознакомьтесь подробно с требованиями к СУБД в xref:ROOT:requirements-database.adoc[соответствующем разделе].
====
+
// end::dbase[]
+
. На странице _Базы данных_ выберите вариант *Создать новую базу данных и подключить её к серверу*, затем нажмите *Далее*.
+
.Создание базы данных
image::install-linux::config-sql.png[Создание базы данных]
+
.. На странице *Базы данных. SQL Server* укажите данные для подключения к СУБД.
+
.Создание новой БД {dv}
image::install-linux::config-sql-server.png[Создание новой БД {dv}]
+
[NOTE]
====
* Для БД PostgreSQL адрес сервера следует указывать без домена (например, `postgre` вместо `postgre.company.com`), или указывать IP адрес.
* Порт указывается только для PostgreSQL (по умолчанию -- `5432`).
* Особенности работы через SQL- и Windows-аутентификацию см. в документации модуля {pl}, раздел "xref:platform:console:db-authentication.adoc[]".
====
+
. На странице _Базы данных. Создание_ укажите имя создаваемой БД.
+
.Создание новой БД {dv}
image::install-linux::config-sql-create.png[Создание новой БД {dv}]
+
* Не используйте кириллицу, пробелы и спецсимволы в имени БД.
* Для БД Microsoft SQL Server в поле _Язык_ выберите локаль БД, установленную в параметре `Server Collation ()` экземпляра Microsoft SQL Server. Рекомендуемое значение: Русский (Cyrillic_General_CI_AS).
* При выборе СУБД Microsoft SQL Server также можно настроить сателлитные БД. Больше информации о сателлитных БД в документации модуля {pl}, раздел "xref:platform:console:db-satellite.adoc[]".
+
WARNING: После создания БД изменять конфигурацию сателлитных БД не рекомендуется. Это может привести к потере данных.
+
. Выберите библиотеки карточек для загрузки в новую БД. По умолчанию будут выбраны все библиотеки, которые можно загрузить. Нажмите *Далее*.
+
.Выбор модулей для загрузки
image::platform:admin:db-create-libs.png[Выбор модулей для загрузки]
+
. Подтвердите параметры, которые будут использованы при создании базы данных. Нажмите *Далее*.
+
.Подтверждение параметров создания БД
image::platform:admin:db-create-check.png[Подтверждение параметров создания БД]
+
include::platform:admin:partial$excerpts.adoc[tags=atomic]
+
. Дождитесь завершения инициализации БД и загрузки SQL объектов.
. На странице загрузки библиотек и настроек карточек дополнительных модулей, выберите модули, которые будут загружены в БД. Не нажимая, кнопки *Завершить*, перейдите к следующему пункту инструкции.
+
.Загрузка библиотек и настроек дополнительных модулей
image::platform:admin:db-create-modules.png[Загрузка библиотек и настроек дополнительных модулей]
+
// . Пропустите шаг перезапуска сервисов нажатием кнопки *Нет*.
// +
. На сервере Linux, в конфигурационном файле модулей укажите имя создаваемой БД xref:config-platform.adoc[конфигурационном файле] модуля {pl} и перезапустите службу *{sss-new}* командой:
+
[source,bash]
----
sudo systemctl restart dvappserver
----
+
// +
// . На странице _Настройки {wincl}а_ оставьте настройки по умолчанию.
// +
// .Настройки {wincl}а
// image::install-linux::config-performance.png[Настройки {wincl}а]
// +
// include::platform:console:db-update.adoc[tags=special]
// +
// . На странице _Завершение конфигурации_ нажмите *Далее*.
// . На страницах "Загрузка специальной конфигурации {dm}" и "Загрузка специальной конфигурации {ad}" нажмите *Далее*, чтобы загрузить данные приложения _{dm}_ и модуля _{ad}_.
// +
// Загрузка данных приложения _{dm}_ и модуля _{ad}_ может быть пропущена, чтобы сохранить существующие настройки модулей.
// +
// include::install-linux::partial$takesTime.adoc[]
// +
// . На странице _Базовые объекты_ нажмите *Далее*. В БД будут загружены данные, необходимые для возможности работы с заданиями с помощью почтового клиента.
// +
// include::install-linux::partial$takesTime.adoc[]
// +
// . Настройте СУБП (сервис управления бизнес-процессами):
// +
// .Загрузка стандартной конфигурации базовых модулей {dv}
// image::install-linux::config-wf.png[Загрузка стандартной конфигурации базовых модулей {dv}]
// +
. Создайте учетную запись для СУБП, подробная инструкция приведена в разделе "xref:install-linux:ROOT:create-wf-account.adoc[]" руководства по установке системы.
// ****
// [lowerroman]
// .. Укажите имя и пароль созданной учетной записи в блоке настроек _Настройки сервиса_.
// .. Нажмите *Далее*, чтобы загрузить настройки модуля _{wf}_.
// +
// Подключение к почтовому серверу может быть настроено позднее.
// +
// Инструкция по настройке почты приведена в документации по администрированию модуля _{wf}_, в разделе "xref:workflow:admin:mail-general-settings.adoc[]".
// ****
+
include::install-linux::partial$takesTime.adoc[]
+
. Нажмите на кнопку *Завершить*.
